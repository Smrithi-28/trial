<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>HMPI Dashboard</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
body { padding: 20px; }
.chart-container { display: flex; flex-wrap: wrap; gap: 20px; margin-bottom: 20px; }
.chart-container img { flex: 1 1 45%; max-height: 300px; object-fit: contain; }
.map-container { height: 200px; width: 100%; border:1px solid #ddd; border-radius:8px; margin-bottom:20px; }
.metal-table { max-height:200px; overflow-y:auto; margin-bottom:20px; }
.table thead th { position: sticky; top:0; background:#343a40; color:white; }
</style>
</head>
<body>
<div class="container">
<h2 class="mt-3 mb-3">HMPI Dashboard ({{ role }})</h2>

<div class="row mb-3">
{% if role=="govt" %}
<div class="col-md-4 mb-2">
<form method="POST" enctype="multipart/form-data">
<input type="file" name="file" class="form-control mb-1">
<button type="submit" class="btn btn-primary btn-sm w-100">Upload CSV</button>
</form>
</div>
{% endif %}
<div class="col-md-4 mb-2">
<form method="get">
<label for="district" class="form-label">Select District:</label>
<select name="district" id="district" class="form-select" onchange="this.form.submit()">
<option value="_all_">All Districts</option>
{% for d in districts %}
<option value="{{ d }}" {% if d == selected %}selected{% endif %}>{{ d }}</option>
{% endfor %}
</select>
</form>
</div>
<div class="col-md-4 mb-2 d-flex align-items-end">
<a href="{{ url_for('logout') }}" class="btn btn-secondary w-100">Logout</a>
</div>
</div>

<div class="chart-container mb-4">
<img src="data:image/png;base64,{{ hist_b64 }}" class="img-fluid rounded shadow">
<img src="data:image/png;base64,{{ pie_b64 }}" class="img-fluid rounded shadow">
</div>

<div class="row mb-4">
<div class="col-lg-7 mb-3">
<div class="map-container">
{{ map_html|safe }}
</div>
</div>

<div class="col-lg-5">
<div class="metal-table">
<h4>Metal Summary</h4>
<table class="table table-bordered table-striped">
<thead><tr><th>Metal</th><th>Mean</th><th>Safe Limit</th><th>Status</th></tr></thead>
<tbody>
{% for metal, mean_val, safe_limit, status in metal_summary %}
<tr><td>{{ metal }}</td><td>{{ mean_val }}</td><td>{{ safe_limit }}</td><td>{{ status }}</td></tr>
{% endfor %}
</tbody>
</table>
</div>
</div>
</div>

</div>
</body>
</html>
